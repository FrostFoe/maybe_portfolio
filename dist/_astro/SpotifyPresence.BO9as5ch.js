import{j as e}from"./utils.34Ufyvpq.js";import{r as a}from"./index.BKXhQhL5.js";import{F as c}from"./index.CaCIcdEA.js";import{S as r}from"./skeleton.DBlny8hb.js";import{c as g}from"./createLucideIcon.CNwVS1sL.js";import"./iconBase.DQdhzIGK.js";/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=g("AudioLines",[["path",{d:"M2 10v3",key:"1fnikh"}],["path",{d:"M6 6v11",key:"11sgs0"}],["path",{d:"M10 3v18",key:"yhl04a"}],["path",{d:"M14 8v7",key:"3a1oy3"}],["path",{d:"M18 5v13",key:"123xd1"}],["path",{d:"M22 10v3",key:"154ddg"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S=g("MoveUpRight",[["path",{d:"M13 5H19V11",key:"1n1gyv"}],["path",{d:"M19 5L5 19",key:"72u4yj"}]]),f="spotify-presence-cache",T=5*60*1e3,M=2e3,D=3,H=()=>{const[l,u]=a.useState(null),[j,h]=a.useState(!0),[A,i]=a.useState(null),n=a.useRef(0),m=a.useRef(null),y=()=>{try{const t=localStorage.getItem(f);if(t){const s=JSON.parse(t);if(!(Date.now()-s.timestamp>T))return s.track}}catch(t){console.warn("Failed to parse cached data:",t),localStorage.removeItem(f)}return null},N=t=>{try{const s={track:t,timestamp:Date.now()};localStorage.setItem(f,JSON.stringify(s))}catch(s){console.warn("Failed to cache data:",s)}},d=async(t=0)=>{try{const s=new AbortController,p=setTimeout(()=>s.abort(),1e4),o=await fetch("https://lastfm-last-played.biancarosa.com.br/frostfoe/latest-song",{signal:s.signal,headers:{"Cache-Control":"no-cache"}});if(clearTimeout(p),!o.ok)throw new Error(`HTTP ${o.status}: ${o.statusText}`);const x=await o.json();if(x.track)u(x.track),N(x.track),i(null),n.current=0;else throw new Error("No track data received")}catch(s){console.error(`Fetch attempt ${t+1} failed:`,s),t<D?(n.current=t+1,m.current=setTimeout(()=>{d(t+1)},M*(t+1))):(i("Failed to load music data"),n.current=0)}finally{h(!1)}};if(a.useEffect(()=>{const t=y();return t?(u(t),h(!1),i(null),d().catch(()=>{})):d(),()=>{m.current&&clearTimeout(m.current)}},[]),j&&!l)return e.jsxs("div",{className:"relative flex h-full w-full flex-col justify-between p-6",children:[e.jsx(r,{className:"mb-2 size-[60%]"}),e.jsx("div",{className:"flex min-w-0 flex-1 flex-col justify-end overflow-hidden",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(r,{className:"h-4 w-36"}),e.jsx(r,{className:"h-5 w-3/4"}),e.jsx(r,{className:"h-3 w-1/2"}),e.jsx(r,{className:"h-3 w-2/3"})]})}),e.jsx("div",{className:"text-primary absolute top-0 right-0 m-3",children:e.jsx(c,{size:56})}),e.jsx(r,{className:"absolute right-0 bottom-0 m-3 h-10 w-10 rounded-full"})]});if(!l)return e.jsxs("div",{className:"relative flex h-full w-full flex-col justify-between p-6",children:[e.jsx("div",{className:"flex h-full items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(c,{size:48,className:"text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"No music data available"})]})}),e.jsx("div",{className:"text-primary absolute top-0 right-0 m-3",children:e.jsx(c,{size:56})})]});const{name:b,artist:v,album:w,image:k,url:E}=l;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative flex size-full flex-col justify-between gap-4 p-6",children:[e.jsx("div",{className:"aspect-square min-h-0 max-w-[60%] flex-shrink border bg-cover bg-center grayscale sepia-50",style:{backgroundImage:`url(${k[3]["#text"]})`},role:"img","aria-label":"Album art"}),e.jsx("div",{className:"flex min-h-0 flex-shrink-0 flex-col justify-end",children:e.jsxs("div",{className:"mr-8 flex flex-col",children:[e.jsxs("span",{className:"mb-2 flex items-center gap-2",children:[e.jsx(R,{size:16,className:"text-primary"}),e.jsx("span",{className:"text-primary text-sm",children:l["@attr"]?.nowplaying==="true"?"Now playing...":"Last played..."})]}),e.jsx("span",{className:"text-md mb-2 line-clamp-2 leading-tight font-medium",children:b}),e.jsxs("span",{className:"text-muted-foreground line-clamp-1 text-xs",children:[e.jsx("span",{className:"text-muted-foreground",children:"by"})," ",v["#text"]]}),e.jsxs("span",{className:"text-muted-foreground line-clamp-1 text-xs",children:[e.jsx("span",{className:"text-muted-foreground",children:"on"})," ",w["#text"]]})]})})]}),e.jsx("div",{className:"text-primary absolute top-0 right-0 m-3",children:e.jsx(c,{size:56})}),e.jsx("a",{href:E,"aria-label":"View on last.fm",title:"View on last.fm",target:"_blank",rel:"noopener noreferrer",className:"bg-border/50 text-primary ring-ring group/spotify-link absolute end-0 bottom-0 m-3 rounded-full p-3 transition-[box-shadow] duration-300 hover:ring-2 focus-visible:ring-2",children:e.jsx(S,{size:16,className:"transition-transform duration-300 group-hover/spotify-link:rotate-12"})})]})};export{H as default};
